## 记录和总结一些东西但不限于此

### 系统重构与升级

从某种意义上来说，系统有两种：一种是自己写的系统，一种是别人写的系统。别人写的系统是很多程序猿的痛，因为程序员之间的技能差异，知识面的不同以及其他主观因素导致别人写的系统大多数会被认为不是亲生的而被鄙弃。可是现实的工作中难免会遇到别人写的系统，或者是接手了一个别人的亲儿子系统或者依赖于一个别人写系统。既然躲不掉，那么就要想办法去让这个别人写的系统能够给自己带来更少的麻烦。

文人相轻，不知道什么时候开始程序猿也开始了相轻。除非你自己就是一个不负责的人，不然没有哪个程序猿会对自己从头新建的系统采用一种糊弄的态度。当然我在工作中也写过很多的垃圾代码，有些的确是因为工期等资源严重不足导致的妥协，但是绝大多数是因为当时的能力所限。回想一下你的码农生涯，是不是经常会看两个月前自己的代码觉得这简直就是一坨那啥。如果没有那么说明这段时间荒废了，没有成长。上面这些其实都是想说明一件事情——别人写的系统那也是别人的亲儿子，那也是当时这个构建者在他的能力范围内尽力所完成的，所以我们没理由做后妈就不一棒子把这个别人的亲儿子给打死。当然你打死了还得再生一个替代的出来，这个代价可能不会被你的公司允许。当然如果公司允许且你又有足够的信心那么可以忽略以下的内容，去拥抱你的亲儿子吧。从头新建一个系统是一件很有乐趣的事情，这个话题在另外一篇里面再说（我比较幸运的从零开始新建了很多系统，这是一种幸运，也是一种挑战）。

看到这里我想你已经主动或者被动的接受了别的程序猿写出来的亲儿子，那么这个孩子到你手里可能是已经被玩坏了的情况。已经七手了的系统并且打了百八十个奇葩的补丁，甚至已经功能不全（源码缺失）。这个时候你一定要平静下来，抱怨不会概念这个可怜孩子的状况，对它有耐心一点。第一件要做的事情是评估出这个系统现在最大的问题是什么？当然你可能觉得代码就是一坨屎很烂是最大的问题，如果你这么想那么你就已经偏离了目的。代码重量，执行效率都是在功能的可用为前提之后考虑的事情；首先要做的是如何让这个被百般蹂躏的系统可以对即将到来的修改可扩展（是扩展，尽量不要去做修改，能扩展的先做扩展），如何让它可以顺利的进行部署，如何让它有一个合理的结构方便进行后续的工作。

这个适合你要衡量你手里的资源，资源有很多种，核心的是：你手下的人（当然如果你是独狼就比较省事了，人心永远是世界上最难搞定的东西），你马上要完成的功能，你的时间资源（工期）。然后根据上面的情况来选择进行以下的工作，并确定优先级。

1. **源码工程的整理**

源码工程的整理其实是一件完全看经验的事情，这里面有很多的问题都是具体项目中才会遇到的，比如源码的缺失。源码缺失了你就只能去反编译，比较幸运的是你的同行一般不会做代码混淆，所以你还是可以搞定这个问题。有人喜欢用maven把工程弄成很多个模块，这在有些时候的确可以降低模块间的源码间的杂糅，但是过度的使用了这个只会把简单的事情变得更加复杂。我做过各种类型的项目，用户很多的，用户不基本不愿意使用的，政务的，互联网的，教育的，ERP的等等，这些系统会有着不同的复杂度，有些根本无需拆分。所以你拿到的工程你要搞清楚它究竟是否需要那么多的模块化的工程，如果不需要你就要自己想办法去减少模块。对于maven工程，你要查看每一个pom文件，这个很重要，因为很多人的pom都会引用了很多无用的东西，并且使用了很多完全没必要的东西。这里有一个很好用的办法，给你的个工程找一个良好的血统，这样可以省很多事情，比如你可以让你的工程继承自spring boot（我刚刚完成的工作就是这么做的，效果很不错，很多的依赖问题都可以规避掉）。

2. **依赖包的升级**

依赖包的升级这个玩意可能会给你带来附加的工作，比如升级后不兼容的代码需要修改，包之间的版本不兼容导致的各种问题。这些完全就是看你自己的经验和能力了，能够自己解决一些没有遇到的问题还是很开心的事情。如果你碰到了一个stackoverflow上没有的问题，那么解决的过程或会很困难但是更有成就感。

3. **打包工作的优化**

不要小瞧了打包的工作，能够依赖于工具自动化完成的工作一定不要用人工来做。我在人人贷数据研究院的时候，我们数据平台只有5个人，所以能用自动化的东西一定不要想着人来完成，无论是自动化集成还是发布，甚至你应用中的某些功能也要自动化完成，谁都不想整个周末都要在电脑前候命等着去修改应用的配置。现在很多的自动化持续集成工具，尽量让所有的工作让工具完成，习惯了你会发现这样可以让你避免很多的简单而致命的错误。发布前最好要做好回滚的所有脚本和准备，上线后很可能会出现一些意想不到的问题，环境和代码都可能有问题。

4. **源码质量的提升**

源码质量的提升是一个依赖于人的工作，当然也可以在某种程度上使用工具，静态代码检查还有sorna等工具都可以使用（虽然我最近整理的工程sorna检查过后我已经有些绝望了）。这些工具的好处是可以帮你避免一些潜在的bug。还有就是测试用例的编写，很多人都不会愿意写测试用例，但是当你的项目组人手不足并且经常要做快速迭代的时候，你最好写测试用例，实在不行也要在核心的服务上写测试用例。没看错，人越少越要写，因为你写完之后它可以让你在发版的时候更加有信心，会在后续的工作中节省很多的时间。

5. **冗余功能的合并或剔除**

补丁太多了一定会有各种冗余的功能，这些是需要在你有时间并且足够了解业务的时候才可以做的工作。它与功能复杂度的集中要同时进行，目的很简单，我需要修改一个功能，那么最好我只去一个地方修改，所有实用这个功能的地方就都修复了。

6. **功能复杂度的集中**

7. **性能优化**

性能优化考验的是你的代码能力和经验了。一个功能可以实现的方式都有自己的性能特性，编码中也有，你工程的技术选型也会影响这个。你知识面更广，知道的工具更多也会影响性能。这个就是一个架构师核心竞争力了，其实架构师更应该有广阔的知识面，可以在一种场景中找到更多的可用的方案，然后可以区分出使用的那种技术组合更加适合要解决的问题。
